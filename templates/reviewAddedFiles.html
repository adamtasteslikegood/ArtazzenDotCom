{% extends "admin_base.html" %}

{% block title %}Review Uploaded Artwork{% endblock %}
{% block page_heading %}Review Uploaded Artwork{% endblock %}

{% block content %}
<div id="pending-list" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
  {% for item in pending_images %}
    <div class="col">
      <article class="image-card card h-100 shadow-sm p-3" data-image-name="{{ item.name }}">
        <div class="image-card__preview ratio ratio-4x3 mb-3">
          <a href="{{ url_for('preview_image_metadata', image_name=item.name) }}">
            <img src="{{ item.url }}" alt="{{ item.title or item.name }}" class="img-fluid rounded border" loading="lazy">
          </a>
        </div>

        <div class="image-card__meta d-flex flex-column gap-2">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="fw-semibold mb-0">{{ item.title or item.name }}</h5>
            {% if item.ai_generated %}
              <span class="badge bg-secondary">AI generated</span>
            {% else %}
              <span class="badge bg-light text-dark border">Needs text</span>
            {% endif %}
          </div>

          <p class="filename small text-muted mb-0">{{ item.name }}</p>

          {% if item.caption %}
            <p class="caption fst-italic text-muted mb-0">{{ item.caption }}</p>
          {% endif %}

          {% if item.description %}
            <p class="description">{{ item.description }}</p>
          {% else %}
            <p class="description text-muted fst-italic">No description detected yet.</p>
          {% endif %}

          {% if item.tags %}
            <ul class="list-inline small mb-0">
              {% for tag in item.tags %}
                <li class="list-inline-item border rounded-pill px-2 py-1 bg-light text-dark">{{ tag }}</li>
              {% endfor %}
            </ul>
          {% endif %}

          <div class="image-card__footer d-flex justify-content-between align-items-center mt-auto flex-wrap gap-2">
            {% if item.ai_details and (item.ai_details.created or item.ai_details.attempted_at) %}
              <span class="timestamp small text-muted" data-ts="{{ item.ai_details.created or item.ai_details.attempted_at }}"></span>
            {% endif %}
            <div class="image-card__actions d-flex gap-2 justify-content-end flex-wrap">
              <a class="btn btn-outline-primary btn-sm" href="{{ url_for('preview_image_metadata', image_name=item.name) }}">
                Review details
              </a>
            </div>
          </div>
        </div>
      </article>
    </div>
  {% endfor %}
</div>

{% if not pending_images %}
  <div class="alert alert-info text-center mt-5">
    No new files waiting for review. Upload artwork to begin curating descriptions.
  </div>
{% endif %}
{% endblock %}
{% block scripts %}
  <script src="{{ url_for('static', path='js/admin.js') }}"></script>
  <script src="{{ url_for('static', path='js/review.js') }}"></script>
{% endblock %}